{"version":3,"sources":["../../src/lib/md-datatable.store.ts"],"names":[],"mappings":"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","file":"md-datatable.store.js","sourcesContent":["import { Injectable, Inject, Optional, InjectionToken } from '@angular/core';\nimport { Observable } from 'rxjs/Observable';\nimport { BehaviorSubject } from 'rxjs/BehaviorSubject';\nimport { queue } from 'rxjs/scheduler/queue';\nimport 'rxjs/add/operator/observeOn';\nimport 'rxjs/add/operator/withLatestFrom';\n\nimport {\n  IDatatablesState,\n  IDatatableAction,\n  IReduxDevToolsExtension,\n  IReduxDevToolsConnection,\n} from './md-datatable.interfaces';\n\nimport { DatatableReducer } from './md-datatable.reducer';\n\n// For easing upgrading the library, I refrained myself of depending on @ngrx/store.\n// I chose the alternative of implementing a Redux Store in just these 50 LOC.\n\nexport const STORE_INITIAL_STATE: InjectionToken<IDatatablesState> =\n  new InjectionToken('ng2-md-datatable-test-initial-state');\n\nexport const REDUX_DEVTOOLS_EXTENSION: InjectionToken<IReduxDevToolsExtension> =\n  new InjectionToken('redux-devtools');\n\nexport function reduxDevToolsExtensionFactory(): IReduxDevToolsExtension | null {\n  const REDUX_DEVTOOLS_KEY = '__REDUX_DEVTOOLS_EXTENSION__';\n\n  return typeof (window) === 'object' &&\n    typeof (window[REDUX_DEVTOOLS_KEY]) === 'function' ?\n    <IReduxDevToolsExtension>window[REDUX_DEVTOOLS_KEY] : null;\n}\n\n@Injectable()\nexport class MdDatatableDispatcher extends BehaviorSubject<IDatatableAction> {\n  static INIT = 'ng2-md-datatable/store/init';\n\n  constructor() {\n    super({ datatableId: '', type: MdDatatableDispatcher.INIT });\n  }\n\n  dispatch(action: IDatatableAction) {\n    this.next(action);\n  }\n}\n\n@Injectable()\nexport class MdDatatableStore extends Observable<IDatatablesState> {\n  private instanceId = `ng2-md-datatable-store-${Date.now()}`;\n  private state$: BehaviorSubject<IDatatablesState>;\n\n  constructor(\n    private dispatcher$: MdDatatableDispatcher,\n    @Inject(STORE_INITIAL_STATE) initialState: IDatatablesState,\n    reducer: DatatableReducer,\n    @Inject(REDUX_DEVTOOLS_EXTENSION) @Optional() reduxDevToolsExtension: IReduxDevToolsExtension,\n  ) {\n    super();\n\n    this.state$ = new BehaviorSubject<IDatatablesState>(initialState);\n    this.source = this.state$;\n    let reduxDevToolsConnection: IReduxDevToolsConnection;\n\n    if (reduxDevToolsExtension) {\n      reduxDevToolsConnection = reduxDevToolsExtension.connect({\n        name: this.instanceId,\n        features: {\n          pause: false,\n          lock: false,\n          persist: false,\n          export: true,\n          import: false,\n          jump: false,\n          skip: false,\n          reorder: false,\n          dispatch: false,\n          test: false,\n        },\n      });\n    }\n\n    this.dispatcher$\n      .withLatestFrom(this.source)\n      .observeOn(queue)\n      .subscribe(([action, state]) => {\n        const newState: IDatatablesState = reducer.reduce(state, action);\n        this.state$.next(newState);\n\n        if (reduxDevToolsConnection) {\n          reduxDevToolsConnection.send(action, newState, undefined, this.instanceId);\n        }\n      });\n  }\n\n  dispatch(action: IDatatableAction) {\n    this.dispatcher$.dispatch(action);\n  }\n}\n"]}